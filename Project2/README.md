# Project2
## 简介
    在网络层模拟实现DV路由算法
## 设计思路
### DV
    设计了两个类，node,topograph
- node:节点类，主要功能有:
    + 接受消息
    + 发送消息
    + 重新计算DV信息
    + 交换DV信息
    + 周期性修改路径权重并告知邻居
- topograph:拓扑图，存储整个拓扑图的信息，负责在每个节点运行之初告诉节点们自己所连接的邻居，以及它们所能够改变权重的路径
    
    节点类所发送的消息类型如下

|字段1|字段2|字段3|字段4|字段5|意义|
|-----|----|-----|-----|----|----|
|0|？|？|？|？|接受到了要转发给别人的消息|
|1|src_ip|dst_ip|message|/|接受到了别人发给自己的信息|
|2|route_weight_change|new_weight|/|/|“感知”到了路径的变化，实际上是修改了路径权重的邻居告诉它|
|3|？|？|？|？|邻居发来的down信息|


### LS（如果有时间）
    设计了两个类，router和LSGraph
- router：路由器节点
- LSGraph：拓扑图信息类

|字段1|字段2|字段3|字段4|字段5|意义|
|-----|----|-----|-----|----|----|
|0|src_ip|dst_ip|msg|/|接受到了有意义的消息|
|1|src_name|dst_name|weight|TTL|接受到路由广播包|
|2|route_weight_change|new_weight|/|/|“感知”到了路径的变化，实际上是修改了路径权重的邻居告诉它|
|3|？|？|？|？|邻居发来的down信息|

## 具体实现
### DV
#### node
    类中的成员变量：
- sck_input:收套接字
- sck_output：发套接字
- ip:自身的ip
- neighbour:指示了到某邻居的路径花销。dict类型，建立了邻居ip和路径权重的一一对应关系
- table:路由表，字典类型，建立了目的地址和下一条地址的一一对应关系
- DV:指示到某个节点的最佳路径开销，字典类型，建立了节点ip和路径开销的一一对应关系
- DV_neighbour:list类型；存储邻居的DV信息；依次为A,B,C,D,E，不是邻居的置为空的字典。
- changable_route:指示自己能够修改的路径。list类型，存储的是某些邻居的ip，表示它能够修改自己到这个邻居的路径权重

    类的函数：
- send_message：发送消息，（可否修改用于处理所有消息类型？对不同消息类型做出不同反应？）
- recv：接受消息（可否修改用于发送所有消息类型？
- recompute_DV:收到邻居发来的DV信息，重新计算DV，并得出新的路由表（self.table)
- send_DV：给邻居发送自己的DV信息
- pack_message:是否可以整合进send_message中？
- unpack_message：是否可以整合到需要处理消息的函数中？
- change_route：修改路径权重，并通知对应邻居。遍历自己的changeable_route列表，使用随机函数生成新的路径权重，将自身的neighbour中的路径权重信息更新，并且使用套接字向对应邻居发送路径权重变化的消息。

#### topograph
    类中的成员变量：
- name_ip
- link_cost：每一条路径的开销，类型是字典。tuple->int，tuple是由两个节点的ip组成的二元组，用来表示边，对应地有一个开销，为int类型。注意这个仅仅是初始化的开销，后续会动态变化（其实是不是不需要此函数？直接在node初始化中设置自己和邻居开销就可以？）
- ip_changeable_route:存储每一个ip所能够修改的路径信息，类型是字典，str->list,每一个ip对应一个存储了某些邻居ip的list，表示它能够修改自己到这些邻居的路径

    类的函数：
- initiaize_graph:图的初始化，如何连接，哪些节点改哪些路径之类。
- node_changeable_route:直接返回对应ip的可修改路径列表（表现为邻居ip）即可

## 遇到的问题
- 需要周期性调用send_DV，从而达到邻居之间交换DV信息的效果
- 一个全局变量记录IP，list类型即可，依次index为A,B,C,D,E（node和TopoGraph都用这个全局变量？）
- 链路通知错误的问题，比如E通过F（2）再通过A（5）到达C，那么E中的到达C的路由开销为7；在A宕掉的时候，F中到达C的路由开销变为正无穷，这时候它需要更新自己的DV信息，那么去遍历邻居的路由表，遍历E的时候，发现从E到C开销为7，那么它认为通过E可以到达C，但实际上，E是通过F和A到达C的，这条路径实际上并不能走得通，那么F就计算出了一个错误的路由信息。

- 宕掉节点的处理方法：写一个函数，宕掉节点发送自己正无穷路径的信息给邻居，邻居收到了此信息之后更新自己的路由表，将相应的位置设置为正无穷，并告知自己的邻居，

- 初始化DV信息和table的时候，还没有找到怎么到达目的地的路径时，先将cost设置为0，table转发下一跳设置为'DK'
